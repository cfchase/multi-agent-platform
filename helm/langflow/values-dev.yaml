# LangFlow IDE Helm Chart Values for Development
# Chart: langflow-ai/langflow-ide
# Uses our existing PostgreSQL, shared admin-credentials

replicaCount: 1

image:
  repository: langflowai/langflow
  pullPolicy: Always
  tag: "latest"

service:
  type: ClusterIP
  port: 7860

# Use external PostgreSQL (our shared postgres)
externalDatabase:
  enabled: true
  driver: "postgresql"
  host: "postgres"
  port: 5432
  user: "app"
  database: "langflow"
  # Password from existing postgres-secret
  existingSecret: "postgres-secret"
  existingSecretPasswordKey: "POSTGRES_PASSWORD"

# Disable built-in PostgreSQL
postgresql:
  enabled: false

# Disable built-in SQLite
sqlite:
  enabled: false

# Authentication - use shared admin-credentials secret
# These are set via additionalEnvFrom
env:
  - name: LANGFLOW_AUTO_LOGIN
    value: "false"
  - name: LANGFLOW_CONFIG_DIR
    value: "/app/langflow"
  - name: LANGFLOW_ALEMBIC_LOG_FILE
    value: "/app/db/alembic.log"
  - name: LANGFLOW_LOG_LEVEL
    value: "INFO"
  - name: LANGFLOW_UPDATE_STARTER_PROJECTS
    value: "false"
  - name: LANGFLOW_SUPERUSER
    valueFrom:
      secretKeyRef:
        name: admin-credentials
        key: email
  - name: LANGFLOW_SUPERUSER_PASSWORD
    valueFrom:
      secretKeyRef:
        name: admin-credentials
        key: password

# Resources
resources:
  requests:
    memory: "1Gi"
    cpu: "500m"
  limits:
    memory: "2Gi"
    cpu: "1000m"

# Persistent storage for data
persistence:
  enabled: true
  size: 5Gi
  # Uses default storage class

# OpenShift compatibility - let SCC assign UIDs
podSecurityContext: {}

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  capabilities:
    drop:
      - ALL

# Health probes
livenessProbe:
  httpGet:
    path: /health
    port: 7860
  initialDelaySeconds: 120
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /health
    port: 7860
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 10

# Ingress disabled - we use OpenShift Route
ingress:
  enabled: false
