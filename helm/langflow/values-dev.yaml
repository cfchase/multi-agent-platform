# LangFlow IDE Helm Chart Values for Development
# Chart: langflow-ai/langflow-ide
# Uses our existing PostgreSQL, shared admin-credentials

# Disable built-in PostgreSQL (we use our shared postgres)
postgresql:
  enabled: false

# OpenShift compatibility - let SCC assign UIDs
podSecurityContext: {}

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  capabilities:
    drop:
      - ALL

# Ingress disabled - we use OpenShift Route
ingress:
  enabled: false

langflow:
  backend:
    replicaCount: 1
    image:
      repository: langflowai/langflow
      imagePullPolicy: Always
      tag: "latest"
    service:
      type: ClusterIP
      port: 7860
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "1000m"
    probe:
      initialDelaySeconds: 60
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 10

    # Use external PostgreSQL (our shared postgres)
    externalDatabase:
      enabled: true
      driver:
        value: "postgresql"
      host:
        value: "postgres"
      port:
        value: "5432"
      user:
        value: "app"
      password:
        valueFrom:
          secretKeyRef:
            name: postgres-secret
            key: POSTGRES_PASSWORD
      database:
        value: "langflow"

    # Disable built-in SQLite
    sqlite:
      enabled: false

    env:
      - name: LANGFLOW_AUTO_LOGIN
        value: "true"
      - name: LANGFLOW_SKIP_AUTH_AUTO_LOGIN
        value: "true"
      - name: LANGFLOW_CONFIG_DIR
        value: "/tmp/langflow"
      - name: LANGFLOW_COMPONENTS_PATH
        value: "/tmp/langflow/components"
      - name: LANGFLOW_ALEMBIC_LOG_FILE
        value: "/tmp/alembic.log"
      - name: LANGFLOW_LOG_LEVEL
        value: "INFO"
      - name: LANGFLOW_UPDATE_STARTER_PROJECTS
        value: "false"
      - name: LANGFLOW_SUPERUSER
        valueFrom:
          secretKeyRef:
            name: admin-credentials
            key: email
      - name: LANGFLOW_SUPERUSER_PASSWORD
        valueFrom:
          secretKeyRef:
            name: admin-credentials
            key: password
