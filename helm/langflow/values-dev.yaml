# LangFlow IDE Helm Chart Values for Development
# Chart: langflow-ai/langflow-ide
# Uses our existing PostgreSQL, shared admin-credentials

# Disable built-in PostgreSQL (we use our shared postgres)
postgresql:
  enabled: false

# OpenShift compatibility - let SCC assign UIDs
podSecurityContext: {}

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  capabilities:
    drop:
      - ALL

# Ingress disabled - we use OpenShift Route
ingress:
  enabled: false

# Pull secret for private quay.io images
imagePullSecrets:
  - name: quay-pull-secret

langflow:
  backend:
    replicaCount: 1
    image:
      # Custom image with redhat_agents baked in (built via GitLab CI)
      repository: quay.io/cfchase/agents-python-langflow
      imagePullPolicy: Always
      tag: "latest"
    service:
      type: ClusterIP
      port: 7860
    resources:
      requests:
        memory: "2Gi"
        cpu: "1000m"
      limits:
        memory: "4Gi"
        cpu: "2000m"
    probe:
      # Custom image with redhat_agents takes longer to start
      initialDelaySeconds: 120
      periodSeconds: 15
      timeoutSeconds: 10
      failureThreshold: 20

    # Use external PostgreSQL (our shared postgres)
    externalDatabase:
      enabled: true
      driver:
        value: "postgresql"
      host:
        value: "postgres"
      port:
        value: "5432"
      user:
        value: "app"
      password:
        valueFrom:
          secretKeyRef:
            name: postgres-secret
            key: POSTGRES_PASSWORD
      database:
        value: "langflow"

    # Disable built-in SQLite
    sqlite:
      enabled: false

    env:
      - name: LANGFLOW_AUTO_LOGIN
        value: "true"
      - name: LANGFLOW_SKIP_AUTH_AUTO_LOGIN
        value: "true"
      - name: LANGFLOW_CONFIG_DIR
        value: "/tmp/langflow"
      - name: LANGFLOW_COMPONENTS_PATH
        value: "/app/components"
      - name: LANGFLOW_ALEMBIC_LOG_FILE
        value: "/tmp/alembic.log"
      - name: LANGFLOW_LOG_LEVEL
        value: "INFO"
      - name: LANGFLOW_UPDATE_STARTER_PROJECTS
        value: "false"
      # Custom image settings for redhat_agents
      - name: LANGFLOW_LAZY_LOAD_COMPONENTS
        value: "false"
      - name: GOOGLE_CLOUD_PROJECT
        value: "redhat-ai-analysis"
      - name: XDG_STATE_HOME
        value: "/tmp/langflow"
      - name: CONFIG_DIR
        value: "/app/src/config"
      - name: LFX_DEV
        value: "1"
      - name: DO_NOT_TRACK
        value: "true"
      - name: LOG_FILE
        value: "/tmp/redhat_agents_logs/debug.log"
      - name: LANGFLOW_SUPERUSER
        valueFrom:
          secretKeyRef:
            name: admin-credentials
            key: email
      - name: LANGFLOW_SUPERUSER_PASSWORD
        valueFrom:
          secretKeyRef:
            name: admin-credentials
            key: password
